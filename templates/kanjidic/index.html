<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>文 - Practice Kanji by Sentencing</title>
        <meta charset="utf-8">
        <script src="/static/js/jquery-1.7.1.min.js"></script>
		<style type="text/css">
			body {
				background-color: #f0f0f0;
				overflow: hidden;
                text-align: center;
			}
			
			#sentence {
                font-size: 4em;
                margin-bottom: 0px;
                margin-left: 1em;
            }

            #translation {
                font-size: 2em;
            }

            .buttonHolder{ text-align: center; }
            #btn-next {
                padding: 0.8em 1.2em;
                font-size: 1em;
                margin-top: 3em;
            }
            .word {
                display: inline-block;
                margin-left: 0.1em;
                margin-right: 0.1em;
            }
            .furigana {
                font-size: 0.3em;
                margin-bottom: -0.1em;
                color: #AAA;
            }
		</style>
    </head>
    <body>
        <script type="text/javascript">

            $(document).ready(function() {
                
				$("#btn-next").click(function(event) { issueGetSentenceNext() });
                issueGetSentence("私");
            });

            function issueGetSentence(kanji) {

                issueAjaxJSONCall('get_sentence_begin', { 'kanji' : kanji },
                    function(data) { onGetSentence(data); });
            }

            function issueGetSentenceNext() {
                
                issueAjaxJSONCall('get_sentence_next', {},
                    function(data) { onGetSentence(data); });
            }

            function onGetSentence(data) {

                // add the received elements
                if ( data['sentence'] ) {
                    $('#sentence').empty();
                    var chars = data['structure'].split(" ");
                    for (i in chars) {
                        var matchings = chars[i].match(/(.*)\[(.*)\]/);
                        if (matchings == null) {
                            $('#sentence').append("<div class='word'>" + chars[i] + "</div>"); 
                        } else {
                            var word = matchings[1];
                            var reading = matchings[2];
                            var bun = $('#sentence').append("<div class='word'></div>");
                            bun.find(".word").last().append("<div class='furigana'>" + reading + "</div>"); 
                            bun.find(".word").last().append("<div>" + word + "</div>");
                        }
                    }
                    $('#translation').html( data['translations'][0] );
                    if ( data['isLast'] )
                        $('#btn-next').attr("disabled", true);
                }
                else { console.log("should not happen"); }
            }

            function issueAjaxJSONCall(name, params, callback) {

                $.getJSON(name, params, callback).error(
                    function () { alert("Error: the call to '" + name + "' failed."); });
            }
        </script>
        日本語　ー　文
        <p id="sentence">Waiting for sentence...</p>
        <p id="translation">...</p>
        <div class="button-holder">
            <input value="Next Sentence" title="Next Sentence" type="submit" id="btn-next"> 
        </div>
    </body>
</html>


